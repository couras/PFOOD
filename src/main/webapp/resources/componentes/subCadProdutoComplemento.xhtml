<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ps="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:co="http://xmlns.jcp.org/jsf/composite/component">

    <!-- INTERFACE -->
    <cc:interface>
    </cc:interface>

    <!-- IMPLEMENTATION -->
    <cc:implementation>
        <h:form prependId="false">

            <h:panelGroup layout="block"  id="panelGroupSubcadProd" >
                <h:panelGroup layout="block"  id="panelGroupSubcadProdRendered"  rendered="#{produtoMB.obj.idProduto > 0}" >   
                <!-- Nav tabs -->           
                <ul class="nav nav-tabs" role="tablist">

                    <li role="presentation" class="active">
                        <h:commandLink ps:href="#complementosPadrao" ps:aria-controls="complementosPadrao" role="tab" ps:data-toggle="tab" value="Complementos Adicionais">
                            <f:ajax onevent="click" execute="@none" render="@none" listener="#{produtoComplementoMB.setAction(1)}" />
                        </h:commandLink>
                    </li>
                    <li role="presentation"><a href="#complementosAdicionais" aria-controls="complementosAdicionais" role="tab" data-toggle="tab">Complementos Adicionais</a></li>
                    <li role="presentation"><a href="#complementosOpcionais" aria-controls="complementosOpcionais" role="tab" data-toggle="tab">Complementos Opcionais</a></li>
                    <li role="presentation"><a href="#imagens" aria-controls="imagens" role="tab" data-toggle="tab">Imagens</a></li>

                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="complementosPadrao">



                        <h:panelGroup id="panelCPPEditor" layout="block" >
                            <p:dataTable id="dataTableGrupoProd"   var="cpp" style="font-size: 12px;" value="#{produtoComplementoMB.lista}"
                                         paginator="true"
                                         paginatorTemplate="{PageLinks}"
                                         rows="10">
                                <p:column headerText="Descrição" >
                                    <h:outputText value="#{cpp.descricaoAgrupamento}" />
                                </p:column>

                                <p:column>
                                    <h:commandButton value="edit" > 
                                        <f:ajax onevent="cppleteGrupoProd"   listener="#{produtoComplementoMB.setObj(cpp)}" execute="@this" render="panelGridDadosCPP"/>    
                                    </h:commandButton>
                                </p:column>
                                <p:column>
                                    <h:commandButton value="remove"  > 
                                        <f:ajax   listener="#{produtoComplementoMB.remove(cpp)}"  execute="@this" render="panelCPPEditor panelGridDadosCPP"/>                  
                                    </h:commandButton>
                                </p:column>

                                <f:facet name="footer">
                                    <h:commandLink class="btn btn-default"  actionListener="#{produtoComplementoMB.novo()}" title="Novo Registro" value="Novo">
                                        <i class="fa fa-star fa-fw"></i>
                                        <f:ajax  onevent="cppleteGrupoProd"  execute="@this" render="panelGridDadosCPP"/>

                                        <script>
                                            function cppleteGrupoProd(e) {
                                                if (e.status == "success")
                                                    $('#cadCppToggle').collapse('show')
                                                focus("#cadProd\\:subCadProdComp\\:inputTextDescGrupoProd")
                                            }
                                        </script>
                                    </h:commandLink>
                                </f:facet>

                            </p:dataTable>

                        </h:panelGroup>


                        <hr/>
                        <!--modal-->
                        <div   id="cadCppToggle" class="collapse">

                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <button type="button" class="close" onclick="$('#cadCppToggle').collapse('hide')" aria-hidden="true">×</button>
                                    <h4 class="panel-title">Dados do Grupo</h4>
                                </div>
                                <h:panelGroup id="panelGridDadosCPP" layout="block"  class="panel-body">
                                    <div class="row">
                                        <h:panelGroup layout="block"  class="form-group">
                                            <div class="input-group number-spinner col-sm-12 col-lg-12">
                                                <h:outputLabel class="control-label" for="inputTextDescricaoAgrupamento" value="Descricao"/>
                                                <h:inputText class="form-control" id="inputTextDescricaoAgrupamento" value="#{produtoComplementoMB.obj.descricaoAgrupamento}" >
                                                </h:inputText>
                                            </div>    
                                        </h:panelGroup>
                                        <h:panelGroup layout="block"  class="form-group">
                                            <h:outputLabel class="control-label" for="autoCompleteCPP" value="Complemento"/>
                                            <div class="input-group number-spinner col-sm-3 col-lg-5">
                                                <p:autoComplete id="autoCompleteCPP" value="#{produtoComplementoMB.obj.complemento}" completeMethod="#{produtoComplementoMB.autoCompleteComplemento}"
                                                                var="c" itemLabel="#{c.descricao}" itemValue="#{c}" converter="complementoConverter" forceSelection="true" />                                              
                                            </div>
                                        </h:panelGroup>
                                        <h:panelGroup layout="block"  class="form-group">
                                            <co:spinner ids="spinQtde" label="Quantidade padrao" min="1" max="1000" value="#{produtoComplementoMB.obj.quantidade}"  />
                                        </h:panelGroup>
                                        <h:panelGroup layout="block"  class="form-group">
                                            <co:spinner ids="inputTextQtdelim" label="Quantidade maxima" min="0" max="1000" value="#{produtoComplementoMB.obj.quantidadeLimite}" />
                                        </h:panelGroup>

                                        <h:panelGroup layout="block"  class="panel-footer">

                                            <h:commandButton class="btn btn-primary" value="Salvar" >
                                                <f:ajax execute="panelGridDadosCPP"  listener="#{produtoComplementoMB.save()}"  render="panelGridDadosCPP panelCPPEditor" />

                                            </h:commandButton>
                                        </h:panelGroup>


                                    </div>
                                </h:panelGroup>
                            </div></div>
                            </div>
                        <div role="tabpanel" class="tab-pane" id="complementosAdicionais">...</div>
                        <div role="tabpanel" class="tab-pane" id="complementosOpcionais">...</div>
                        <div role="tabpanel" class="tab-pane" id="imagens">...</div>
                    </div>
                </h:panelGroup>
            </h:panelGroup>
        </h:form>
    </cc:implementation>
</html>